!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("ng-magnizoom",["exports","@angular/core","@angular/common"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["ng-magnizoom"]={},t.ng.core,t.ng.common)}(this,(function(t,e,o){"use strict";var i=function(){};i.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new i},token:i,providedIn:"root"}),i.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],i.ctorParameters=function(){return[]};var n=function(){function t(){this.zoomMode="COVER",this.minZoomFactor=1.2,this.maxZoomFactor=3,this.zoomFactor=2,this.zoomFactorChange=new e.EventEmitter,this.lensSizeUnit="NORMALIZED",this.lensSize={width:.5,height:.5},this.zoomCenterUnit="NORMALIZED",this.zoomCenterChange=new e.EventEmitter,this.updateOnMouseEvents=!0,this.imageReady=!1}return Object.defineProperty(t.prototype,"canvasWidth",{get:function(){return this.image&&this.image.width||800},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasHeight",{get:function(){return this.image&&this.image.height||600},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){this.initContext(),this.loadImage(this.imageSrc)},t.prototype.ngOnChanges=function(t){t&&((t.lensSize||t.zoomCenter||t.zoomFactor)&&this.updateParameters(),t.imageSrc&&!t.imageSrc.firstChange&&this.loadImage(t.imageSrc.currentValue))},t.prototype.initContext=function(){this.canvas=this.mainCanvasRef.nativeElement,this.context=this.canvas.getContext("2d")},t.prototype.loadImage=function(t){var e=this;this.image=new Image,this.image.onload=function(){e.imageReady=!0,e.updateParameters(),setTimeout((function(){return e.update()}))},this.image.src=t},t.prototype.updateParameters=function(){"NORMALIZED"===this.lensSizeUnit?this.imageReady&&(this._lensSize={width:this.lensSize.width*this.image.width,height:this.lensSize.height*this.image.height}):this._lensSize={width:this.lensSize.width,height:this.lensSize.height},this.zoomCenter?"NORMALIZED"===this.zoomCenterUnit?this.imageReady&&(this._centerPosition={x:this.zoomCenter.x*this.image.width,y:this.zoomCenter.y*this.image.height}):this._centerPosition={x:this.zoomCenter.x,y:this.zoomCenter.y}:this._centerPosition=void 0,this._zoomFactor=this.zoomFactor,this._zoomFactor>this.maxZoomFactor&&(this._zoomFactor=this.maxZoomFactor),this._zoomFactor<this.minZoomFactor&&(this._zoomFactor=this.minZoomFactor),this.update()},t.prototype.update=function(){var t,e,o,i;this.render();var n,s=!1;this._centerPosition?"NORMALIZED"===this.zoomCenterUnit?this.imageReady&&(s=(n={x:this._centerPosition.x/this.image.width,y:this._centerPosition.y/this.image.height}).x!==(null===(t=this.zoomCenter)||void 0===t?void 0:t.x)||n.y!==(null===(e=this.zoomCenter)||void 0===e?void 0:e.y)):s=(n={x:this._centerPosition.x,y:this._centerPosition.y}).x!==(null===(o=this.zoomCenter)||void 0===o?void 0:o.x)||n.y!==(null===(i=this.zoomCenter)||void 0===i?void 0:i.y):s=(n=void 0)!==this.zoomCenter,s&&this.zoomCenterChange.emit(n)},t.prototype.render=function(){if(this.context&&this.imageReady&&(this.context.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.context.lineWidth=1,this.context.drawImage(this.image,0,0),this._centerPosition))switch(this.zoomMode){case"LENS":this.renderLensMode();break;case"COVER":this.renderCoverMode()}},t.prototype.renderLensMode=function(){this.context.lineWidth=5;var t=this.getZoomRect();this.context.fillRect(t.x,t.y,t.w,t.h);var e=this.getClippingRect();this.context.drawImage(this.image,e.x,e.y,e.w,e.h,t.x,t.y,t.w,t.h),this.context.strokeRect(t.x,t.y,t.w,t.h)},t.prototype.renderCoverMode=function(){var t=this.getCoverRect();this.context.drawImage(this.image,t.x,t.y,t.w,t.h,0,0,this.canvasWidth,this.canvasHeight)},t.prototype.getZoomRect=function(){var t=this._lensSize.width,e=this._lensSize.height,o=this._centerPosition.x-t/2,i=this._centerPosition.y-e/2;return this.clampRect(o,i,t,e)},t.prototype.getClippingRect=function(){var t=this._lensSize.width/this._zoomFactor,e=this._lensSize.height/this._zoomFactor,o=this._centerPosition.x-t/2,i=this._centerPosition.y-e/2;return this.clampRect(o,i,t,e)},t.prototype.getCoverRect=function(){var t=this.canvasWidth/this._zoomFactor,e=this.canvasHeight/this._zoomFactor,o=this._centerPosition.x-this._centerPosition.x/this._zoomFactor,i=this._centerPosition.y-this._centerPosition.y/this._zoomFactor;return this.clampRect(o,i,t,e)},t.prototype.clampRect=function(t,e,o,i){return t<=0&&(t=0),t+o>=this.canvasWidth&&(t=this.canvasWidth-o),e<0&&(e=0),e+i>=this.canvasHeight&&(e=this.canvasHeight-i),{x:t,y:e,w:o,h:i}},t.prototype.calculateMousePosition=function(t,e){var o=this.canvas.getBoundingClientRect(),i=this.canvasWidth/o.width,n=this.canvasHeight/o.height,s=(t-o.left)*i,a=(e-o.top)*n;this._centerPosition={x:s,y:a}},t.prototype.onMouseLeave=function(t){this.updateOnMouseEvents&&(this._centerPosition=null,this.update())},t.prototype.onMouseEnterOrMove=function(t){this.updateOnMouseEvents&&(this.calculateMousePosition(t.clientX,t.clientY),this.update())},t.prototype.onMouseScroll=function(t){if(this.updateOnMouseEvents){var e=this._zoomFactor;(e-=t.deltaY/1e3)<this.minZoomFactor&&(e=this.minZoomFactor),e>this.maxZoomFactor&&(e=this.maxZoomFactor),this._zoomFactor!==e&&(this._zoomFactor=e,this.zoomFactor!==this._zoomFactor&&this.zoomFactorChange.emit(this._zoomFactor),this.update()),t.preventDefault(),t.stopPropagation()}},t}();n.decorators=[{type:e.Component,args:[{selector:"ng-magnizoom",template:'<canvas #mainCanvas\n  class="main-canvas"\n  [ngClass]="imageClass"\n  [ngStyle]="imageStyle"\n  [width]="canvasWidth"\n  [height]="canvasHeight"\n  (mouseleave)="onMouseLeave($event)"\n  (mouseenter)="onMouseEnterOrMove($event)"\n  (mousemove)="onMouseEnterOrMove($event)"\n  (wheel)="onMouseScroll($event)">\n</canvas>\n',styles:[""]}]}],n.ctorParameters=function(){return[]},n.propDecorators={imageSrc:[{type:e.Input}],zoomMode:[{type:e.Input}],minZoomFactor:[{type:e.Input}],maxZoomFactor:[{type:e.Input}],zoomFactor:[{type:e.Input}],zoomFactorChange:[{type:e.Output}],lensSizeUnit:[{type:e.Input}],lensSize:[{type:e.Input}],zoomCenterUnit:[{type:e.Input}],zoomCenter:[{type:e.Input}],zoomCenterChange:[{type:e.Output}],updateOnMouseEvents:[{type:e.Input}],imageStyle:[{type:e.Input}],imageClass:[{type:e.Input}],mainCanvasRef:[{type:e.ViewChild,args:["mainCanvas",{static:!0}]}]};var s=function(){};s.decorators=[{type:e.NgModule,args:[{declarations:[n],imports:[o.CommonModule],exports:[n]}]}],t.MagnizoomService=i,t.NgMagnizoomComponent=n,t.NgMagnizoomModule=s,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-magnizoom.umd.min.js.map